# 模板类型区分说明

## 概述

系统中存在两种模板类型，需要严格区分，不能混为一谈：

1. **提示词模板（CallWord）** - 模板类型：1
2. **评分模板（PromptTemplate）** - 模板类型：2

## 模板类型定义

### 1. 提示词模板（CallWord）
- **表名**：`wc_call_word`
- **主键**：`platform_id` (String类型，如 "wechat_layout", "zhihu_layout")
- **模板类型标识**：`template_type = 1`
- **主要字段**：
  - `platform_id`: 平台标识（主键）
  - `word_content`: 提示词内容
  - `is_common`: 是否为公共模板
  - `user_id`: 创建用户ID
  - `status`: 上架状态（0-草稿 1-已上架）
  - `price`: 模板价格
  - `sales_count`: 销量
  - `income_total`: 累计收益

### 2. 评分模板（PromptTemplate）
- **表名**：`wc_prompt_template`
- **主键**：`id` (Long类型)
- **模板类型标识**：`template_type = 2`
- **筛选条件**：`type = 3`（评分模板的type字段值为3）
- **主要字段**：
  - `id`: 模板ID（主键）
  - `name`: 模板名称
  - `prompt`: 提示词内容
  - `type`: 模板类型（3表示评分模板）
  - `user_id`: 创建用户ID
  - `is_common`: 是否为公共模板
  - `status`: 上架状态（0-草稿 1-已上架）
  - `price`: 模板价格
  - `sales_count`: 销量
  - `income_total`: 累计收益

## 购买记录表（wc_template_purchase）

购买记录表需要区分两种模板类型：

- **template_type**: 模板类型（1-提示词模板 2-评分模板）
- **template_id**: 模板ID（提示词模板用platformId字符串，评分模板用id数字转字符串）

### 唯一索引
```sql
UNIQUE KEY `uk_template_user` (`template_type`, `template_id`, `user_id`)
```

这样可以确保同一用户对同一模板类型下的同一模板只能购买一次。

## 代码实现规范

### 1. 方法命名和注释
所有方法必须明确标注是哪种模板类型：

```java
/**
 * 购买评分模板（模板类型：2-评分模板）
 * 注意：此方法仅用于购买评分模板，提示词模板的购买需要使用其他方法
 */
ResultBody purchaseTemplate(Long templateId);
```

### 2. 查询方法
所有查询方法必须明确传入 `templateType` 参数：

```java
// 评分模板查询
templatePurchaseMapper.selectByTemplateIdAndUserId(2, templateId.toString(), userId);

// 提示词模板查询（如果实现）
templatePurchaseMapper.selectByTemplateIdAndUserId(1, platformId, userId);
```

### 3. 购买记录创建
创建购买记录时必须设置 `templateType`：

```java
TemplatePurchase purchase = new TemplatePurchase();
purchase.setTemplateType(2); // 评分模板
purchase.setTemplateId(templateId.toString());
// ...
```

### 4. 查询购买记录
查询购买记录时必须指定 `templateType`：

```java
// 查询评分模板的购买记录
List<Map<String, Object>> list = templatePurchaseMapper.selectPurchasedTemplatesByUserId(
    2, // templateType: 评分模板
    userId,
    name,
    offset,
    limit
);
```

## 前端API规范

### 评分模板相关接口
- `/mini/getMyCreatedTemplates` - 查询我创建的评分模板
- `/mini/getMyPurchasedTemplates` - 查询我购买的评分模板
- `/mini/getMarketTemplates` - 查询市场中的评分模板
- `/mini/purchaseTemplate/{templateId}` - 购买评分模板

### 提示词模板相关接口
提示词模板的市场功能（如果实现）应使用不同的接口路径，例如：
- `/mini/getMyCreatedCallWords` - 查询我创建的提示词模板
- `/mini/getMyPurchasedCallWords` - 查询我购买的提示词模板
- `/mini/getCallWordMarket` - 查询市场中的提示词模板
- `/mini/purchaseCallWord/{platformId}` - 购买提示词模板

## 注意事项

1. **严格区分**：所有操作必须明确区分是评分模板还是提示词模板
2. **类型检查**：在购买、查询等操作前，必须验证模板类型
3. **数据一致性**：确保购买记录表中的 `template_type` 和 `template_id` 与实际的模板类型匹配
4. **接口隔离**：不同模板类型的操作应使用不同的接口，避免混淆

## 数据库迁移

如果已有购买记录数据，需要执行以下SQL更新：

```sql
-- 参考 sql/update_template_purchase_table.sql
-- 1. 添加 template_type 字段
-- 2. 修改 template_id 字段类型为 varchar
-- 3. 更新现有数据的 template_type
-- 4. 更新索引
```

