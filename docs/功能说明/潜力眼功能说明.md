# æ½œåŠ›çœ¼åŠŸèƒ½æ–‡æ¡£

> åŸºäºè…¾è®¯å…ƒå™¨æ™ºèƒ½ä½“çš„å¯¹è¯æµç®€å†æ™ºèƒ½åˆ†æè¯„ä»·åº”ç”¨  
> ç‰ˆæœ¬ï¼šv1.0  
> æ›´æ–°æ—¶é—´ï¼š2026-01-02

---

## ğŸ“– ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#-åŠŸèƒ½æ¦‚è¿°)
2. [æŠ€æœ¯æ¶æ„](#-æŠ€æœ¯æ¶æ„)
3. [æ•°æ®åº“è®¾è®¡](#-æ•°æ®åº“è®¾è®¡)
4. [æ ¸å¿ƒåŠŸèƒ½å®ç°](#-æ ¸å¿ƒåŠŸèƒ½å®ç°)
---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

### ä»€ä¹ˆæ˜¯æ½œåŠ›çœ¼ï¼Ÿ

**æ½œåŠ›çœ¼**æ˜¯ä¸€ä¸ªåŸºäºAIå¤§æ¨¡å‹çš„ç®€å†æ™ºèƒ½åˆ†æè¯„ä»·åº”ç”¨ï¼Œé€šè¿‡é›†æˆè…¾è®¯å…ƒå™¨æ™ºèƒ½ä½“å¹³å°ï¼Œå¸®åŠ©HRåˆ†æç®€å†ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ… **åˆ†æç®€å†æ–‡ä»¶**  
  æ ¹æ®ç”¨æˆ·çš„è¦æ±‚å’Œä¸Šä¼ çš„ç®€å†æ–‡ä»¶ï¼Œä½¿ç”¨å¤§æ¨¡å‹è‡ªä¸»åˆ†æç®€å†ï¼Œç”Ÿæˆç›¸å…³è¯„ä»·

### ä¸šåŠ¡æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·æ“ä½œ                                  â”‚
â”‚   1. è¾“å…¥è¦æ±‚å¹¶ä¸Šä¼ ç®€å†æ–‡ä»¶                                     â”‚
â”‚   2. ç‚¹å‡»"æ¶ˆæ¯å‘é€"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              è…¾è®¯å…ƒå™¨å·¥ä½œæµæ‰§è¡Œ                               â”‚
â”‚   1. å‚æ•°æå–ï¼šresumeFiles,sessionld,message,isEmptyResumeFilesâ”‚
â”‚   2. åˆ¤æ–­ï¼š                                                  â”‚
â”‚       if(isEmptyResumeFiles=True):                        â”‚
                è°ƒç”¨å¤§æ¨¡å‹â€”â€”>HTTPå›è°ƒï¼Œä¿å­˜å›å¤ä¿¡æ¯            â”‚ 
        else: è¯æ˜ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¸ä¸ºç©º                
â”‚   3. ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶ä¸ä¸ºç©ºï¼Œè°ƒç”¨å¾ªç¯èŠ‚ç‚¹ï¼Œä½¿ç”¨æ–‡æ¡£è§£æå·¥å…·å°†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è§£æï¼Œç”Ÿæˆå†…å®¹â”‚
â”‚   4. å°†è§£æçš„åçš„æ–‡æ¡£å†…å®¹äº¤ç»™å¤§æ¨¡å‹                        â”‚
â”‚   5. HTTPå›è°ƒï¼Œä¿å­˜å›å¤ä¿¡æ¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å‰ç«¯å±•ç¤º                                     â”‚
â”‚   1. å®šæ—¶åˆ·æ™ºèƒ½ä½“çš„å›å¤ä¿¡æ¯ï¼ˆçº¦æ¯10ç§’ä¸€æ¬¡ï¼‰            â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ

#### åç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šSpring Boot 3.x
- **ORM**ï¼šMyBatis
- **æ•°æ®åº“**ï¼šMySQL 8.0 Redis 8
- **å®‰å…¨**ï¼šSpring Security + JWT
- **HTTPå®¢æˆ·ç«¯**ï¼šRestTemplate

#### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**ï¼šVue 3
- **UIåº“**ï¼šElement Plus
- **HTTPå®¢æˆ·ç«¯**ï¼šAxios

#### AIå¹³å°
- **æ™ºèƒ½ä½“å¹³å°**ï¼šè…¾è®¯å…ƒå™¨ï¼ˆYuanqiï¼‰
- **å·¥ä½œæµå¼•æ“**ï¼šè…¾è®¯å…ƒå™¨å·¥ä½œæµ
- **å¤§æ¨¡å‹**ï¼š
    - ç²¾è°ƒçŸ¥è¯†å¤§æ¨¡å‹é«˜çº§ç‰ˆï¼ˆæ ¹æ®ç”¨æˆ·è¦æ±‚è§£æç®€å†æ–‡ä»¶ï¼‰
    - æ€è€ƒæ¨¡å‹é«˜çº§ç‰ˆï¼ˆç”¨æˆ·å¯¹è¯ï¼‰

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‰ç«¯ (Vue3 + Element Plus)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚ ç”¨æˆ·ç™»å½•  â”‚  â”‚ æ¶ˆæ¯å‘é€   â”‚  â”‚ å†…å®¹å±•ç¤º  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  åç«¯ (Spring Boot)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Controllerå±‚                                          â”‚     â”‚
â”‚  â”‚  - PotentialEyeAuthController (ä¼ä¸šå¾®ä¿¡ç™»å½•)            â”‚      â”‚ 
â”‚  â”‚  - ChannelCallbackController() (ä¼ä¸šå¾®ä¿¡å›è°ƒ)          â”‚     â”‚
â”‚  â”‚  - PotentialEyeChatController() (æ¶ˆæ¯å¯¹è¯)             â”‚     â”‚
â”‚  â”‚  - SysRegisterUserWxController() (ç”¨æˆ·æ³¨å†Œ)
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Serviceå±‚                                             â”‚     â”‚
â”‚  â”‚  - IChatFileService (æ–‡ä»¶å­˜å‚¨ä¸šåŠ¡)                       â”‚     â”‚
â”‚  â”‚  - IChatMessageService (æ¶ˆæ¯å‘é€ç­‰ç›¸å…³ä¸šåŠ¡)              â”‚      â”‚     
â”‚  â”‚  - ISysUserWxService (ä¼ä¸šå¾®ä¿¡ç™»å½•ä¸šåŠ¡)                    â”‚     â”‚
â”‚  â”‚  - WxTokenService (è·å–tokenä¸šåŠ¡)                      â”‚       â”‚
â”‚  â”‚  - WeWorkAuthService(ä¼ä¸šå¾®ä¿¡è®¤è¯æœåŠ¡)                 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                       â†“                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Mapperå±‚ (MyBatis)                                    â”‚     â”‚
â”‚  â”‚  - ChatFileMapper                                 â”‚     â”‚
â”‚  â”‚  - ChatMessageMapper                            â”‚     â”‚
â”‚  â”‚  - SysUserWxMapper                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MySQL æ•°æ®åº“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ chat_file        â”‚  â”‚chat_message      â”‚  â”‚  sys_user_wxâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### è¡¨1ï¼šchat_fileï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰

å­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„ç®€å†æ–‡ä»¶ã€‚

```sql
DROP TABLE IF EXISTS `chat_file`;
CREATE TABLE `chat_file`  (
                              `file_id` bigint NOT NULL AUTO_INCREMENT COMMENT 'æ–‡ä»¶ID',
                              `message_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ¶ˆæ¯ID',
                              `file_name` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ä»¶åç§°',
                              `file_path` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„',
                              `file_url` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'å­˜å‚¨åçš„é“¾æ¥',
                              `create_time` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
                              PRIMARY KEY (`file_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 110 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;

```

### è¡¨2ï¼šchat_messageï¼ˆå¯¹è¯æ¶ˆæ¯è¡¨ï¼‰

å­˜å‚¨ç”¨æˆ·ä¸æ™ºèƒ½ä½“çš„å¯¹è¯å’Œå›å¤ä¿¡æ¯ã€‚

```sql
DROP TABLE IF EXISTS `chat_message`;
CREATE TABLE `chat_message`  (
                                 `chat_id` bigint NOT NULL AUTO_INCREMENT COMMENT 'å¯¹è¯ä¿¡æ¯ID',
                                 `message_id` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'æ¶ˆæ¯IDï¼Œç”¨äºå»é‡',
                                 `session_id` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ä¼šè¯IDï¼ˆç”¨æˆ·æ ‡è¯†ï¼‰',
                                 `content` text CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL COMMENT 'æ¶ˆæ¯å†…å®¹',
                                 `role` enum('USER','AI') CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT 'USER' COMMENT 'è§’è‰²\"è°å‘çš„æ¶ˆæ¯\"',
                                 `is_read` tinyint(1) NULL DEFAULT 0 COMMENT 'æ˜¯å¦å·²è¯»ï¼š0-æœªè¯», 1-å·²è¯»',
                                 `point_cost` int NULL DEFAULT NULL COMMENT 'å¯¹è¯æ¶ˆè€—çš„ç§¯åˆ†',
                                 `created_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
                                 `update_time` datetime NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
                                 PRIMARY KEY (`chat_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 115 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;

```
### è¡¨3ï¼šsys_user_wxï¼ˆä¼ä¸šå¾®ä¿¡ç™»å½•è¡¨ï¼‰

å­˜å‚¨ä¼ä¸šå¾®ä¿¡ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯ã€‚

```sql
CREATE TABLE `sys_user_wx`  (
                                `wx_id` bigint NOT NULL AUTO_INCREMENT COMMENT 'ä¼ä¸šç™»å½•è¡¨ID',
                                `session_id` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL COMMENT 'ç™»å½•ç”¨æˆ·çš„session_id',
                                `user_id` bigint NULL DEFAULT NULL COMMENT 'å…³è”çš„ç”¨æˆ·id',
                                PRIMARY KEY (`wx_id`) USING BTREE
) ENGINE = InnoDB AUTO_INCREMENT = 10 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;

```

---

## ğŸ’» æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. ä¼ä¸šå¾®ä¿¡ç™»å½•

#### åç«¯æ ¸å¿ƒä»£ç 

**PotentialEyeAuthController.java**

```java
@Anonymous
@GetMapping("/callback")
public void handleCallback(@RequestParam("code") String code,
                           jakarta.servlet.http.HttpServletResponse response) throws java.io.IOException {
    try {
        log.info("[æˆæƒ] å¤„ç†å›è°ƒ - code: {}", code);
        WeWorkLoginResult result = weWorkSimpleAuthService.handleOAuthCallback(code);
        String userId = result.getWeWorkUserId();
        // åˆ¤æ–­tokenæ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è·³è½¬åˆ°æ³¨å†Œé¡µé¢
        if (ObjectUtil.isNull(result.getToken())) {
            // å½“å‰ç”¨æˆ·ä¸å­˜åœ¨äºæ•°æ®åº“ä¸­ï¼Œè·³è½¬åˆ°æ³¨å†Œé¡µé¢
            log.info("[æˆæƒ] ç”¨æˆ·æœªæ³¨å†Œï¼Œè·³è½¬åˆ°æ³¨å†Œé¡µé¢ - weWorkUserId: {}", userId);
            response.setContentType("text/html; charset=UTF-8");
            response.getWriter().write(
                    "<!DOCTYPE html>" +
                            "<html>" +
                            "<head>" +
                            "  <meta charset=\"UTF-8\">" +
                            "  <title>ç™»å½•æˆåŠŸ</title>" +
                            "  <style>" +
                            "    body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }" +
                            "    .success { color: #67C23A; font-size: 24px; margin-bottom: 20px; }" +
                            "    .loading { color: #909399; font-size: 16px; }" +
                            "  </style>" +
                            "</head>" +
                            "<body>" +
                            "  <div class=\"success\">âœ“ ç™»å½•å¤±è´¥ï¼Œæ²¡æœ‰ç”¨æˆ·ä¿¡æ¯</div>" +
                            "  <div class=\"loading\">æ­£åœ¨è·³è½¬åˆ°æ³¨å†Œé¡µé¢...</div>" +
                            "  <script>" +
                            "    localStorage.setItem('sessionId', '" + userId + "');" +
                            "    sessionStorage.setItem('wework_login', JSON.stringify({" +
                            "      weWorkUserId: '" + userId + "'," +
                            "      sessionId: '" + userId + "'" +
                            "    }));" +
                            "    setTimeout(function() {" +
                            "      window.location.href = '/register';" +
                            "    }, 500);" +
                            "  </script>" +
                            "</body>" +
                            "</html>"
            );
        }else {
            // ç”¨æˆ·å·²å­˜åœ¨ï¼Œæ­£å¸¸å¤„ç†ç™»å½•é€»è¾‘
            // å°†è¿™ä¸ªä¿¡æ¯å­˜å‚¨åœ¨redisä¸­
            redisCache.setCacheObject("loginResult", result);
            String token = result.getToken();
            // è¿”å›HTMLé¡µé¢ï¼Œä½¿ç”¨JavaScriptä¿å­˜tokenå¹¶è·³è½¬
            response.setContentType("text/html; charset=UTF-8");
            response.getWriter().write(
                    "<!DOCTYPE html>" +
                            "<html>" +
                            "<head>" +
                            "  <meta charset=\"UTF-8\">" +
                            "  <title>ç™»å½•æˆåŠŸ</title>" +
                            "  <style>" +
                            "    body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }" +
                            "    .success { color: #67C23A; font-size: 24px; margin-bottom: 20px; }" +
                            "    .loading { color: #909399; font-size: 16px; }" +
                            "  </style>" +
                            "</head>" +
                            "<body>" +
                            "  <div class=\"success\">âœ“ ç™»å½•æˆåŠŸ</div>" +
                            "  <div class=\"loading\">æ­£åœ¨è·³è½¬åˆ°å¯¹è¯é¡µé¢...</div>" +
                            "  <script>" +
                            "    localStorage.setItem('token', '" + token + "');" +
                            "    localStorage.setItem('sessionId', '" + userId + "');" +
                            "    sessionStorage.setItem('token', '" + token + "');" +
                            "    sessionStorage.setItem('wework_login', JSON.stringify({" +
                            "      weWorkUserId: '" + userId + "'," +
                            "      sessionId: '" + userId + "'" +
                            "    }));" +
                            "    setTimeout(function() {" +
                            "      window.location.href = '/chat';" +
                            "    }, 500);" +
                            "  </script>" +
                            "</body>" +
                            "</html>"
            );
        }
    } catch (Exception e) {
        log.error("[æˆæƒ] ä¼ä¸šå¾®ä¿¡ç™»å½•å¤±è´¥", e);
        response.setContentType("text/html; charset=UTF-8");
        response.getWriter().write(
                "<!DOCTYPE html>" +
                        "<html>" +
                        "<head>" +
                        "  <meta charset=\"UTF-8\">" +
                        "  <title>ç™»å½•å¤±è´¥</title>" +
                        "  <style>" +
                        "    body { font-family: Arial, sans-serif; text-align: center; padding: 50px; }" +
                        "    .error { color: #F56C6C; font-size: 24px; margin-bottom: 20px; }" +
                        "    .message { color: #909399; font-size: 16px; margin-bottom: 30px; }" +
                        "    .btn { display: inline-block; padding: 10px 20px; background: #409EFF; color: white; text-decoration: none; border-radius: 4px; }" +
                        "  </style>" +
                        "</head>" +
                        "<body>" +
                        "  <div class=\"error\">âœ— ç™»å½•å¤±è´¥</div>" +
                        "  <div class=\"message\">" + e.getMessage() + "</div>" +
                        "  <a href=\"/\" class=\"btn\">è¿”å›é¦–é¡µ</a>" +
                        "</body>" +
                        "</html>"
        );
    }
}

```

### 2. è…¾è®¯å…ƒå™¨APIè°ƒç”¨

**PotentialEyeChatUtil.java**

```java
  public String sendMessage(String message, String sessionId, List<String> chatFileUrlList) {
    log.info("[å…ƒå™¨è¯·æ±‚] å¼€å§‹å¤„ç† - sessionId: {}, message: {}", sessionId, message);

    String targetUrl = yuanqiChatConfig.getTargetUrl();
    String token = yuanqiChatConfig.getToken();
    String encodingAesKey = yuanqiChatConfig.getEncodingAesKey();
    String corpId = yuanqiChatConfig.getCorpId();
    String agentId = yuanqiChatConfig.getAgentId();

    log.info("[å…ƒå™¨é…ç½®] targetUrl: {}", targetUrl);
    log.info("[ä¼ä¸šå¾®ä¿¡è®¤è¯] corpId: {}", corpId);

    try {
        log.info("[åŠ å¯†å¤„ç†] å¼€å§‹åˆå§‹åŒ–åŠ å¯†å™¨");
        WXBizMsgCrypt crypt = new WXBizMsgCrypt(token, encodingAesKey, corpId);
        log.info("[åŠ å¯†å¤„ç†] åŠ å¯†å™¨åˆå§‹åŒ–æˆåŠŸ");

        long timestamp = System.currentTimeMillis() / 1000;
        String timestampStr = String.valueOf(timestamp);
        String nonce = generateNonce();

        // æ„å»ºæ¶ˆæ¯ä½“ï¼Œå°†resumeUrlListä¿¡æ¯ç¼–ç åˆ°æ¶ˆæ¯ä¸­
        StringBuilder messageBuilder = new StringBuilder();
        messageBuilder.append("[SID:").append(sessionId).append("]");
        messageBuilder.append(message);

        if (chatFileUrlList != null && !chatFileUrlList.isEmpty()) {
            messageBuilder.append(" [RESUMES:");
            for (int i = 0; i < chatFileUrlList.size(); i++) {
                if (i > 0) {
                    messageBuilder.append(",");
                }
                messageBuilder.append(chatFileUrlList.get(i));
            }
            messageBuilder.append("]");
        }

        String wrappedMessage = messageBuilder.toString();
        log.info("[æ¶ˆæ¯æ„å»º] åŒ…è£…åæ¶ˆæ¯: {}", wrappedMessage);

        // æ„å»ºä¼ä¸šå¾®ä¿¡XMLæ ¼å¼æ¶ˆæ¯
        String xmlMessage = String.format(
                "<xml>" +
                        "<ToUserName><![CDATA[yuanqi]]></ToUserName>" +
                        "<FromUserName><![CDATA[%s]]></FromUserName>" +
                        "<CreateTime>%d</CreateTime>" +
                        "<MsgType><![CDATA[text]]></MsgType>" +
                        "<Content><![CDATA[%s]]></Content>" +
                        "<MsgId>%d</MsgId>" +
                        "<AgentID>%s</AgentID>" +
                        "</xml>",
                sessionId,
                timestamp,
                wrappedMessage,
                System.currentTimeMillis(),
                agentId != null ? agentId : "1000011" //1000011ä¸ºæ¨¡å‹ID
        );

        log.info("[æ¶ˆæ¯æ„å»º] XMLæ¶ˆæ¯æ„å»ºå®Œæˆï¼Œé•¿åº¦: {}", xmlMessage.length());

        // AESåŠ å¯†
        log.info("[åŠ å¯†å¤„ç†] å¼€å§‹AESåŠ å¯†");
        String encryptedXml = crypt.encryptMsg(xmlMessage, timestampStr, nonce);
        log.info("[åŠ å¯†å¤„ç†] åŠ å¯†å®Œæˆï¼Œå¯†æ–‡é•¿åº¦: {}", encryptedXml.length());

        // ä»åŠ å¯†åçš„XMLä¸­æå–MsgSignature
        String msgSignature = extractMsgSignature(encryptedXml);
        log.info("[ç­¾åéªŒè¯] æ¶ˆæ¯ç­¾å: {}", msgSignature);

        // æ„å»ºè¯·æ±‚URL
        String requestUrl = buildRequestUrl(targetUrl, msgSignature, timestampStr, nonce);
        // æ„å»ºè¯·æ±‚å®ä½“
        HttpEntity<String> requestEntity = buildSimpleRequestEntity(encryptedXml);

        log.info("[HTTPè¯·æ±‚] å‡†å¤‡å‘é€ - URL: {}", requestUrl);
        log.info("[HTTPè¯·æ±‚] è¯·æ±‚ä½“é•¿åº¦: {} bytes", encryptedXml.getBytes().length);
        log.info("[HTTPè¯·æ±‚] file URLæ•°é‡: {}", chatFileUrlList != null ? chatFileUrlList.size() : 0);

        long startTime = System.currentTimeMillis();
        ResponseEntity<String> response = restTemplate.exchange(
                requestUrl,
                HttpMethod.POST,
                requestEntity,
                String.class
        );

        long elapsedTime = System.currentTimeMillis() - startTime;
        log.info("[HTTPå“åº”] è¯·æ±‚å®Œæˆ - è€—æ—¶: {}ms, çŠ¶æ€ç : {}",
                elapsedTime, response.getStatusCodeValue());

        return processSimpleResponse(response);

    } catch (org.springframework.web.client.HttpClientErrorException e) {
        log.error("[HTTPé”™è¯¯] å®¢æˆ·ç«¯é”™è¯¯ - çŠ¶æ€ç : {}, é”™è¯¯ä¿¡æ¯: {}",
                e.getStatusCode(), e.getMessage());
        return "å‘é€å¤±è´¥ï¼š" + e.getStatusCode() + " - " + e.getResponseBodyAsString();
    } catch (org.springframework.web.client.HttpServerErrorException e) {
        log.error("[HTTPé”™è¯¯] æœåŠ¡å™¨é”™è¯¯ - çŠ¶æ€ç : {}, é”™è¯¯ä¿¡æ¯: {}",
                e.getStatusCode(), e.getMessage());
        return "å…ƒå™¨æœåŠ¡å¼‚å¸¸ï¼š" + e.getStatusCode() + " - " + e.getResponseBodyAsString();
    } catch (Exception e) {
        log.error("[ç³»ç»Ÿé”™è¯¯] å‘é€æ¶ˆæ¯å¤±è´¥ - å¼‚å¸¸ç±»å‹: {}, é”™è¯¯ä¿¡æ¯: {}",
                e.getClass().getName(), e.getMessage(), e);
        return "ç³»ç»Ÿå¼‚å¸¸ï¼š" + e.getMessage();
    }
}
```

### 3. å·¥ä½œæµHTTPå›è°ƒæ¥æ”¶

**PotentialEyeChatController.java**

```java
    @Anonymous
@PostMapping("/workflow/callback")
public AjaxResult handleWorkflowCallback(@RequestBody Map<String, Object> request) {
    try {
        String sessionId = (String) request.get("sessionId");
        String messageId = (String) request.get("messageId");
        String content = (String) request.get("result");
        log.info("[å·¥ä½œæµå›è°ƒ] æ”¶åˆ°AIå›å¤ - sessionId: {}, å†…å®¹é•¿åº¦: {}", sessionId, content != null ? content.length() : 0);
        if (sessionId == null || sessionId.isEmpty()) {
            return AjaxResult.error("sessionIdä¸èƒ½ä¸ºç©º");
        }
        if (content == null || content.isEmpty()) {
            return AjaxResult.error("contentä¸èƒ½ä¸ºç©º");
        }
        potentialEyeChatUtil.saveAssistantMessage(sessionId,content,messageId);
        log.info("[å·¥ä½œæµå›è°ƒ] AIå›å¤å·²ä¿å­˜ - sessionId: {}", sessionId);
        return AjaxResult.success("OK");

    } catch (Exception e) {
        log.error("[å·¥ä½œæµå›è°ƒ] å¤„ç†å¤±è´¥", e);
        return AjaxResult.error("å¤„ç†å¤±è´¥: " + e.getMessage());
    }
}
```

### 4. å‰ç«¯çŠ¶æ€è½®è¯¢

**chat.vue**

å½“å‰å®ç°æ˜¯**åŸºäºæ™ºèƒ½ä½“æ¶ˆæ¯å›å¤çš„è½®è¯¢åˆ·æ–°**ã€‚æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š

```javascript
const startPolling = () => {
    if (pollTimer) clearTimeout(pollTimer)

    pollTimer = setTimeout(async () => {
        try {
            const res = await pollReply(sessionId.value)
            if (res.code === 200 && res.data) {
                if (res.data.hasReply && res.data.reply) {
                    addAiMessage(res.data.reply)
                    isLoading.value = false
                } else {
                    pollCount++
                    if (pollCount < MAX_POLL) {
                        startPolling()
                    } else {
                        addAiMessage('æ¶ˆæ¯å·²å‘é€ï¼Œå›å¤å¯èƒ½ç¨æœ‰å»¶è¿Ÿ')
                        isLoading.value = false
                    }
                }
            } else {
                pollCount++
                if (pollCount < MAX_POLL) {
                    startPolling()
                } else {
                    isLoading.value = false
                }
            }
        } catch (error) {
            console.error('è½®è¯¢å¤±è´¥:', error)
            pollCount++
            if (pollCount < MAX_POLL) {
                startPolling()
            } else {
                isLoading.value = false
            }
        }
    }, 10000)
}
```
## ğŸ“ æ€»ç»“

æ½œåŠ›åŠŸèƒ½é€šè¿‡æ•´åˆè…¾è®¯å…ƒå™¨æ™ºèƒ½ä½“å¹³å°ï¼Œå®ç°äº†ï¼š

âœ… **æ–‡ä»¶è§£æ**ï¼šæ½œåŠ›çœ¼å®ç°äº†ç”¨æˆ·çš„å¯¹è¯æµç¨‹ï¼ŒåŠæ ¹æ®ç”¨æˆ·è¦æ±‚è§£æç”¨æˆ·çš„æ–‡ä»¶ä¿¡æ¯ï¼Œç»™å‡ºç›¸å¯¹åº”çš„è¯„ä»·

### æŠ€æœ¯äº®ç‚¹

- å¼‚æ­¥ä»»åŠ¡å¤„ç†ï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- HTTPå›è°ƒæœºåˆ¶ï¼Œå®ç°å·¥ä½œæµä¸åç«¯è§£è€¦
- çŠ¶æ€è½®è¯¢è®¾è®¡ï¼Œå®æ—¶å±•ç¤ºè¿›åº¦
- æ¨¡å‹é€‰æ‹©åŠŸèƒ½ï¼Œçµæ´»æ§åˆ¶æˆæœ¬
---

**æœ€åæ›´æ–°**ï¼š2026-01-02  
**ç»´æŠ¤è€…**ï¼šç¦å¸®æ‰‹å¼€å‘å›¢é˜Ÿ
